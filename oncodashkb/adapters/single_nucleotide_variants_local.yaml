row:
    map:
        columns: 
            - pid
        to_subject: patient
transformers:
    - map:
        columns:
            - sample_id
        to_object: sample
        via_relation: patient_carries_sample
    - map:
        columns:
            - alteration
        from_subject: sample
        to_object: alteration
        via_relation: sample_carries_alteration
    - map:
        columns:
            - hugoSymbol
        from_subject: alteration
        to_object: gene
        via_relation: alteration_affects_gene
    - cat_format:
        columns:
          - hugoSymbol
          - gene_role
        from_subject: alteration
        to_object: functional_outcome
        format_string: "{hugoSymbol}:{gene_role}"
        via_relation: alteration_causes_functional_outcome
    - map:
        columns:
            - hugoSymbol
        from_subject: functional_outcome
        to_object: gene
        via_relation: functional_outcome_affects_gene
    - map:
        columns:
            - referenceGenome
        to_property:
            - reference_genome
        for_objects:
            - alteration
    - map:
        columns:
            - tumorType
        to_property:
            - tumor_type
        for_objects:
            - alteration
    - map:
        columns:
            - oncogenic
        to_property:
            - oncogenic
        for_objects:
            - alteration
    - map:
        columns:
            - mutationEffectDescription
        to_property:
            - mutation_effect_description
        for_objects:
            - alteration
    - map:
        columns:
            - variantSummary
        to_property:
            - variant_summary
        for_objects:
            - alteration
    - map:
        columns:
            - tumorTypeSummary
        to_property:
            - tumor_type_summary
        for_objects:
            - alteration
    - map:
        columns:
            - citationPMids
        to_property:
            - citation_PM_ids
        for_objects:
            - alteration
    - map:
        columns:
            - consequence
        to_property:
            - consequence
        for_objects:
            - alteration
    - map:
        columns:
            - level_of_evidence
        to_property:
            - level_of_evidence
        for_objects:
            - alteration
metadata:
        - name: single_nucleotide_variants

validate: # SNV table labeled as "local".
  columns:
    patient_id:
        dtype: str
        description: "Cohort code from clinical data"
    sample_id:
        dtype: str
        description: "Sample id of biopsy (origin OVCA database)"
    ref_id:
        dtype: str
        description: "Reference dbSNP id"
        nullable: true
    chromosome:
        dtype: str
        description: "Chromosome number where alteration is occurring"
        checks:
          str_matches: ^chr[\d|X]+$
    position:
        dtype: int64
        description: "Start position of alteration in chromosome"
    reference_allele:
        dtype: str
        description: "Allele in reference genome"
        checks:
          str_matches: ^[ACTG]+$
    sample_allele:
        dtype: str
        description: "Allele in sample"
        checks:
          str_matches: ^[ACTG]+$
    referenceGenome:
        dtype: str
        description: "Standard human reference genome used in WGS read alignment"
        checks:
          isin:
            value:
              - GRCh37
              - GRCh38
    hugoSymbol:
        dtype: str
        description: "Gene name in Hugo nomenclature"
        checks:
            str_matches: ^[a-zA-Z0-9-]+$
    alteration:
        dtype: str
        description: "Genomic alteration in format hugoSymbol:chromosome:position:reference_allele:sample_allele"
        checks:
            str_matches: ^[a-zA-Z0-9-]+:chr[\d|X|Y]{1,2}:\d+:[ACTG]+>[ACTG]+$
    tumorType:
        dtype: str
        description: "Tumor type abbreviation (OncoTree based)"
        checks:
            isin:
                value:
                    - HGSOC
    consequence: # FIXME: Encountered values significantly different than values described in documentation.
        dtype: str
        description: "Genomic consequence of variant (same as exonicFuncMane)"
        nullable: true
        checks:
            isin:
                value:
                  - stopgain
                  - nonsynonymous_SNV
                  - frameshift_deletion
                  - frameshift_insertion
                  - intergenic
                  - intron
                  - intronic
                  - splicing
                  - upstream
    cytoBand:
        dtype: str
        description: "Chromosomal locus"
    exonicFuncMane:
        dtype: str
        description: "Genomic consequence of variant (from MANE)"
        nullable: true
        checks:
          isin:
            value:
              - frameshift_deletion
              - frameshift_insertion
              - intergenic
              - intron
              - intronic
              - nonsynonymous_SNV
              - splicing
              - stopgain
              - upstream
    funcMane:
        dtype: str
        description: "functional genomic target by MANE"
        nullable: true
        checks:
          isin:
            value:
              - exonic
              - intergenic
              - intron
              - intronic
              - splicing
              - upstream
    AAChangeMANE:
        dtype: str
        description: "Protein change by MANE"
        nullable: true
    funcRefGene:
        dtype: str
        description: "functional genomic target by RefGene"
        nullable: true
        checks:
            isin:
                value:
                  - UTR3
                  - exonic
                  - intergenic
                  - intron
                  - intronic
                  - ncRNA_exonic
                  - ncRNA_intronic
                  - splicing
                  - upstream
    exonicFuncRefGene:
        dtype: str
        description: "Genomic consequence of variant (from RefGene)"
        nullable: true
        checks:
            isin:
                value:
                  - frameshift_deletion
                  - frameshift_insertion
                  - nonsynonymous_SNV
                  - startloss
                  - stopgain
                  - stoploss
                  - synonymous_SNV
                  - unknown
    AAChangerefGene:
        dtype: str
        description: "Protein change by RefGene"
        nullable: true
    nMinor:
        dtype: int64
        description: "Minor allele copynumber (from CNAs if available)"
    nMajor:
        dtype: int64
        description: "Major allele copynumber (from CNAs if available)"
    ad0:
        dtype: int64
        description: "Minor allelele read count"
    ad1:
        dtype: int64
        description: "Major allele read count"
    af:
        dtype: float64
        description: "Expected homozygous allele frequency"
    depth:
        dtype: int64
        description: "Total read count (=ad0+ad1)"
    lohstatus:
        dtype: str
        description: "Loss of heterozygosity status (from CNAs if available)"
        nullable: true
        checks:
          isin:
            value:
              - HET
              - LOH
    hom_lo:
        dtype: float64
        description: "Lower bound for expected homogeneity confidence interval"
    hom_hi:
        dtype: float64
        description: "Higher bound for expected homogeneity confidence interval"
    hom_pbinom_lo:
        dtype: float64
        description: "Binomial distribution probability for expected homogeneity"
    homogenous:
        dtype: boolean
        description: "Predicted homogenous if hom_pbinom_lo > 0.05)"
        nullable: true
        checks:
          isin:
            value:
              - True
              - False
    cadd_score:
        dtype: float64
        description: "CADD score from WGS annotations"
        nullable: true
    ada_score:
        dtype: float64
        description: "Ada boost score from WGS annotations"
        nullable: true
    rf_score:
        dtype: float64
        description: "Random forest score from WGS annotations"
        nullable: true
    amis_category:
        dtype: str
        description: "Alphamissense category from WGS annotations"
        nullable: true
        checks:
          isin:
            value:
              - pathogenic
              - likely_pathogenic
              - benign
              - likely_benign
              - ambiguous
    amis_score:
        dtype: str
        description: "Alphamissense score from WGS annotations. Value space 0.0-1.0  (can be also expressed with range eg: 0.3324,0.4355 or max first eg: 0.4355,0.3324)"
        nullable: true
    sift_category:
        dtype: str
        description: "SIFT category from WGS annotations (not yet available in WGS annotations)"
        nullable: true
        checks:
          isin:
            value:
              - pathogenic
              - likely_pathogenic
              - benign
              - likely_benign
              - ambiguous
    sift_score:
        dtype: float64
        description: "SIFT score from WGS annotations (not yet available in WGS annotations)"
        nullable: true
    polyphen_category:
        dtype: str
        description: "Polyphen category from WGS annotations (not yet available in WGS annotations)"
        nullable: true
        checks:
          isin:
            value:
              - pathogenic
              - likely_pathogenic
              - benign
              - likely_benign
              - ambiguous
    polyphen_score:
        dtype: float64
        description: "Polyphen score from WGS annotations (not yet available in WGS annotations)"
        nullable: true
    pathogenecity:
        dtype: str
        description: "Estimated pathogenecity by voting from differrent scoring systems"
        nullable: true
        checks:
          isin:
            value:
              - pathogenic
              - likely_pathogenic
              - benign
              - likely_benign
              - ambiguous
    cosmic_id:
        dtype: str
        description: "COSMIC databse ID"
        nullable: true
    clinvar_id:
        dtype: str
        description: "ClinVar databse ID"
        nullable: true
    clinvar_sig:
        dtype: str
        description: "ClinVar pathogenecity prediction"
        nullable: true
        checks:
          isin:
            value:
              - pathogenic
              - likely_pathogenic
              - benign
              - likely_benign
              - ambiguous
    clinvar_status:
        dtype: str
        description: "ClinVar variant status"
        nullable: true
    clinvar_assoc:
        dtype: str
        description: "ClinVar cancer type associations"
        nullable: true
    classification:
        dtype: str
        description: "Consequence based classification used for grouping in UI"
        checks:
            isin:
                value:
                  - Missense
                  - Splicing
                  - Truncating
                  - Other