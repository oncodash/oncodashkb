row:
    map:
        columns: 
            - patient_id
        to_subject: patient
transformers:
    - map:
        columns:
            - sample_id
        to_object: sample
        via_relation: patient_carries_sample
    - map:
        columns:
            - alteration
        from_subject: sample
        to_object: alteration
        via_relation: sample_carries_alteration
    # - map:
    #     columns:
    #         - hugoSymbol
    #     from_subject: alteration
    #     to_object: gene
    #     via_relation: alteration_affects_gene
    - cat_format:
        columns:
          - hugoSymbol
          - gene_role
        from_subject: alteration
        to_object: gene_status
        format_string: "{hugoSymbol}:{gene_role}"
        via_relation: alteration_causes_gene_status
    - map:
        columns:
            - hugoSymbol
        from_subject: gene_status
        to_object: protein
        via_relation: gene_status_affects_protein
    # - map:
    #     columns:
    #         - referenceGenome
    #     to_property:
    #         - reference_genome
    #     for_objects:
    #         - alteration
    - map:
        columns:
            - tumorType
        to_property:
            - tumor_type
        for_objects:
            - alteration
    - map:
        columns:
            - oncogenic
        to_property:
            - oncogenic
        for_objects:
            - alteration
    - map:
        columns:
            - mutationEffectDescription
        to_property:
            - mutation_effect_description
        for_objects:
            - alteration
    - map:
        columns:
            - variantSummary
        to_property:
            - variant_summary
        for_objects:
            - alteration
    - map:
        columns:
            - tumorTypeSummary
        to_property:
            - tumor_type_summary
        for_objects:
            - alteration
    - map:
        columns:
            - citationPMids
        to_property:
            - citation_PM_ids
        for_objects:
            - alteration
    - map:
        columns:
            - consequence
        to_property:
            - consequence
        for_objects:
            - alteration
    - map:
        columns:
            - level_of_evidence
        to_property:
            - level_of_evidence
        for_objects:
            - alteration
    - string:
        value: "haha"
        to_property: edgelabel
        for_objects:
            - patient_carries_sample
            - sample_carries_alteration
            - alteration_causes_gene_status
            - gene_status_affects_protein
metadata:
        - name: .

validate: # SNV table labeled as "external".
  strict: true
  columns:
    patient_id:
      dtype: str
      description: "Cohort code from clinical data"
    sample_id:
      dtype: str
      description: "Sample id of biopsy (origin OVCA database)"
    alteration:
      dtype: str
      description: "Genomic alteration in format hugoSymbol:chromosome:position:reference_allele:sample_allele"
      checks:
          str_matches: ^[a-zA-Z0-9-]+:chr[\d|X|Y]{1,2}:\d+:[ACTG]+:[ACTG]+$
    hugoSymbol:
      dtype: str
      description: "Gene name in Hugo nomenclature"
      checks:
          str_matches: ^[a-zA-Z0-9-]+$
    tumorType:
      dtype: str
      description: "Tumor type abbreviation (OncoTree based)"
      checks:
        isin:
          value:
              - HGSOC
    consequence:
      dtype: str
      description: "Genomic consequence of variant from OncoKB or CGI"
      nullable: true
      checks:
          isin:
              value:
                  - 3_prime_UTR_variant
                  - downstream_gene_variant
                  - frameshift_variant
                  - inframe_insertion
                  - intron_variant
                  - missense_variant
                  - splice_acceptor_variant
                  - splice_donor_variant
                  - splice_region_variant
                  - stop_gained
                  - stop_lost
                  - upstream_gene_variant
    oncogenic:
      dtype: str
      description: "Indication of alteration oncogenecity"
      checks:
        isin:
          value:
            - Inconclusive # Not present in source documentation description.
            - Likely Neutral # Not present in source documentation description.
            - Likely Oncogenic
            - Oncogenic
            - Unknown
    mutationEffectDescription:
      dtype: str
      description: "Brief overview of the biological effect of the alteration with references"
      nullable: true
    gene_role:
      dtype: str
      description: "The biological effect of a mutation/alteration on the protein function"
      checks:
        isin:
          value:
            - Gain-of-function
            - Inconclusive
            - Likely Gain-of-function
            - Likely Loss-of-function
            - Likely Neutral
            - Loss-of-function
            - Unknown
            - Act
            - LoF
            - ambiguous
    citationPMids:
      dtype: str
      description: "Citations related to the biological effect separated by semicolon"
      nullable: true
      checks:
        str_matches: ^[0-9]{7,}(,[0-9]{7,})*$
    level_of_evidence:
      dtype: str
      description: "Level of evidence for the alteration"
      nullable: true
      checks:
        isin:
          value:
            - LEVEL_1
            - LEVEL_2
            - LEVEL_3A
            - LEVEL_3B
            - LEVEL_4
            - LEVEL_R1
            - LEVEL_R2
    geneSummary:
      dtype: str
      description: "Brief overview of the gene and its role in cancer"
      nullable: true
    variantSummary:
      dtype: str
      description: "Brief description of the variant oncogenicity"
      nullable: true
    tumorTypeSummary:
      dtype: str
      description: "Describes the therapeutic implication that applies to the indication in cancer"
      nullable: true
